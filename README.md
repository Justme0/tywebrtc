# tywebrtc
WebRTC server play (closed-loop project)

项目背景：与家人使用微信视频通话，感到延迟比较大（北京到上海），回声严重，我听到自己回声后才听到对方的回复，本项目开发一个简洁的传输服务，用户用浏览器进行视频通话，目标是延迟比微信的低，并借助浏览器WebRTC天然的回声消除能力，做到比微信视频通话体验更好，同时让通话者方便接入，前期忽略身份安全问题。

本项目始终要遵守的原则是，简单自包含、依赖少，**有朋友有额外需求的话方便自行修改和扩展，碰到问题看源码能hold住并解决**，这就要求代码架构和可读性良好，错误处理做得好（这跟技术没什么关系了，就看你是否站在开发者用户的角度），市面上有的开源项目代码难懂，出问题不好排查，很多情况不是阅读者的问题，而是代码质量的问题 :)

其次，本项目为了练手才造的轮子，其他开源项目可能有80%的代码是我不需要的，只需要核心的20%的代码实现的功能。

# 一些设计决策和宗旨
- 收发包的buffer用`std::vector<char>`，严禁C风格数组:)，不用unique_ptr<char[]>, unique_ptr<uint8_t[]>，对本条有异议请参考 https://stackoverflow.com/questions/1399891/c-vectorchar-and-sockets/1400289 。代码中尽量不出现new关键字，优先用STL，从根本上避开内存泄露问题，不手动管理内存后，理论上无需写复制构造函数、重载赋值操作符、析构函数（C++典型问题之一，写不必要的Rule of Three）
- 严禁magic number
- 某些场景用std::string代替enum，方便直接打印有意义的名称而不是数字
- 用C++风格而不是C风格（重要），如用默认构造函数代替memset，用std::string 代替 strlen, strcpy，要求开发者有较高的C++水平，请先阅读Effective C++和谷歌编程规范
- 重视单元测试、代码格式化、持续集成（含代码静态分析）、code review
- 如果需要打印类的状态，增加成员函数 std::string ToString() const; 先不考虑转字符串的性能问题，扩展性和可读性优先
- 收拢构造函数、clear、init、reset、reinit等等给成员变量批量赋值的场景，否则以后加一个字段要到处修改
- 越重要的变量、函数、类型，命名的辨识度越高，这点和Golang的命名习惯是一样的，平常可能要经常搜索这些命名，辨识度高可以准确grep
- 允许线上打印本地日志，这就要求日志库的高性能
- 严谨全局变量（前期可能有，后期会重构）
- 可以用局部变量时就不要分配堆对象，Java程序员转C++时请注意
- 尽量不出现原生指针，比如可以用引用代替指针，免得繁琐地判空，容易遗漏出现空指针解引用问题
